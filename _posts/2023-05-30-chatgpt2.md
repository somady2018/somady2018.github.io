---
layout: post
title:  "ChatGPT API를 파이썬으로 활용하기 - 2)챗봇만들기"
subtitle: "API키 발급 및 API 사용법"
thumbnail-img: /assets/img/20230526_chatgpt_1.jpg
cover-img: /assets/img/20230526_cover.jpg
tags: [코알못의코딩공부, ChatGPT, API, python]
categories: [코딩공부]
comments: true
---

파이썬 사용을 위하여 지난 (1)편의 기본세팅을 하였다면, 이제는  
##### 2. CHATGPT의 API key를 발급해보자. <br>

#### (1) openai 에 회원가입 
https://openai.com/ 에 접속하여 Sign UP을 한다. <br>
구글, Apple, Microsoft 계정으로도 가입이 가능하다. 

#### (2) API Key 발급 
로그인 후 본인 계정설정 에서, API를 발급해준다.   https://platform.openai.com/account/api-keys <br>
해당 API는 다시 열어볼 수가 없으니 복사하여 본인만 아는 곳에 잘 붙여넣고 관리해야 한다. <br>

![캡쳐1](/assets/img/20230527_chatgpt_1.JPG)<br>


##### 3. 본격 파이썬 코드를 넣어보자. <br>

위 링크의 예시들을 토대로 나의 vscode 에디터에 복붙해볼 것이다. <br>
가상환경을 만들었던 CHATGPT_API 폴더 내에 'chatgpt.py' 라는 임의의 파이썬 파일을 생성해주었다. 

[OPENAI - API 참조](https://platform.openai.com/docs/api-reference/chat){:target="_blank"}
[OPENAI - 예시참조](https://platform.openai.com/examples){:target="_blank"}


```
import os
import openai
openai.api_key = os.getenv("OPENAI_API_KEY")
```

모든 openai 의 API 사용 시 가장 기본이 되야 할 것은 위의 3줄이다.<br> 
추가로 셋째 줄에서 위 (2)에서 발급받았던 API KEY 를 넣을 때에는 2가지 방법이 있다. 

#### (1) 나의 os 환경변수 안에 저장해두고 사용하기
  환경변수로 저장해둘 경우 코드 자체에서 API가 노출되지 않아 안전하다고 한다. <br>
  Terminal - CMD 창에서 os.environ.get 함수 등을 활용하여 가능하다.<br>
  이 방법은 나의 경우에 오류가 발생하였기에 그냥 키값을 그대로 넣어서 사용하는 방법을 소개한다.<br>

#### (2) key값 그대로 코드에 넣어서 사용하기 
  개인 PC에 한하여 사용한다면 os.getenv 함수를 사용하지 않고 그냥 아래와 같이 Key값을 바로 넣어 사용할 수 있다.<br>
  요금이 과금되므로 타인에게 공유하지 않도록 조심하자! <br>

```
import os
import openai
openai.api_key = "sk-ti~~~~~~jq"
```

#### (활용) 프롬프트 입력 후 답변받기
[OPENAI - API 참조](https://platform.openai.com/docs/api-reference/chat/create){:target="_blank"}<br>

```
response = openai.ChatCompletion.create(
  model="gpt-3.5-turbo",
  messages=[
    {"role": "user", "content": "Hello!"},
  ]
)

print(response['choices'][0]['message']['content'])

```
#### (활용) 챗봇 형태로 주고받기

예시의 경우에 Content 에 특정내용 (ex"HELLO!") 을 넣는 식으로 진행하면 한가지 답변이 뜨고 끝이난다. <br>
계속 질문답변을 주고받는 채팅형식으로 진행하기 위해 '질문:' 이라는 프롬프트를 추가하고 While 반복문을 사용함으로써, <br>
질문 → 답변 → 질문 (반복) 의 형태가 이어지도록 수정해보았다. <br>

```
while True:
  prompt = input("질문:")

  response = openai.ChatCompletion.create(
    model="gpt-3.5-turbo",
    messages=[
      {'role': 'user', 'content': prompt}
    ]
  )
  
  print("답변:")
  print(response['choices'][0]['message']['content'])
  print("================================")
```

이렇게 파이썬으로 실행할 수 있는 나만의 챗봇 완성  ^^! 